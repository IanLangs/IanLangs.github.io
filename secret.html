<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Juego de multiplicaciones y divisiones — Ian</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#7c3aed; /* violeta */
    --muted:#9aa6b2;
    --good:#10b981;
    --bad:#ef4444;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;}
  body{
    margin:0; background:linear-gradient(180deg,var(--bg),#071021 80%); color:#e6eef6;
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    width:720px; max-width:96vw; border-radius:16px; padding:22px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.7);
  }
  h1{margin:0 0 6px 0; font-size:20px; letter-spacing:0.2px}
  p.lead{margin:0 0 18px 0; color:var(--muted); font-size:13px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .controls{display:flex; gap:10px; margin-bottom:14px; align-items:center}
  select,input[type="number"]{padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
  label{font-size:13px; color:var(--muted)}
  .question{
    margin:14px 0; display:flex; align-items:center; gap:10px; justify-content:space-between;
  }
  .math{
    font-size:48px; font-weight:700; letter-spacing:1px;
  }
  .answer-area{display:flex; gap:10px; align-items:center}
  .answer{
    width:160px; padding:10px 12px; font-size:18px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit;
  }
  button{
    background:var(--accent); color:white; border:0; padding:10px 14px; border-radius:10px; cursor:pointer;
    box-shadow: 0 6px 18px rgba(124,58,237,0.16); font-weight:600;
  }
  button.ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); box-shadow:none}
  .feedback{height:24px; margin-top:8px; font-weight:700}
  .feedback.good{color:var(--good)}
  .feedback.bad{color:var(--bad)}
  .stats{display:flex; gap:12px; color:var(--muted); font-size:13px; margin-top:12px; align-items:center}
  .small{font-size:12px; color:var(--muted)}
  footer{margin-top:16px; display:flex; justify-content:space-between; align-items:center;}
  .hint{font-size:12px;color:var(--muted)}
  .range-inputs{display:flex;gap:8px;align-items:center}
  .chip{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);font-size:13px}
  .controls-wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
  @media(max-width:560px){
    .math{font-size:36px}
    .answer{width:120px}
  }
</style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Práctica de multiplicaciones y divisiones</h1>
    <p class="lead">Preguntas infinitas, aleatorias y con divisiones que siempre dan enteros. Contesta y presiona Enter o Verificar.</p>

    <div class="controls-wrap">
      <div class="controls" aria-hidden="false">
        <label for="operation">Operación</label>
        <select id="operation" title="Elige multiplicación, división o ambas">
          <option value="both">Multiplicación y División</option>
          <option value="mult">Multiplicación</option>
          <option value="div">División</option>
        </select>
      </div>

      <div class="controls">
        <label class="small">Rango de operandos</label>
        <div class="range-inputs">
          <input id="minVal" type="number" value="2" min="0" step="1" title="Valor mínimo para operandos/resultado" />
          <span class="chip">a</span>
          <input id="maxVal" type="number" value="12" min="1" step="1" title="Valor máximo para operandos/resultado" />
        </div>
      </div>

      <div class="controls">
        <label class="small">Modo</label>
        <select id="mode">
          <option value="both">Operandos aleatorios</option>
          <option value="productSmall">Multiplicaciones con producto pequeño (más simples)</option>
        </select>
      </div>

      <div style="margin-left:auto">
        <button id="resetBtn" class="ghost" title="Reiniciar estadísticas">Reiniciar</button>
      </div>
    </div>

    <div class="question" aria-live="polite">
      <div>
        <div class="math" id="mathDisplay">?</div>
        <div class="small hint" id="hint">Pulsa Enter para enviar — las divisiones siempre serán enteras</div>
      </div>

      <div class="answer-area">
        <input id="answerInput" class="answer" inputmode="numeric" autocomplete="off" placeholder="Tu respuesta" aria-label="Respuesta numérica" />
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
          <button id="checkBtn">Verificar</button>
          <button id="skipBtn" class="ghost">Saltar</button>
        </div>
      </div>
    </div>

    <div class="feedback" id="feedback" aria-live="assertive"></div>

    <div class="stats" aria-hidden="false">
      <div class="chip">Puntaje: <span id="score">0</span></div>
      <div class="chip">Intentos: <span id="attempts">0</span></div>
      <div class="chip">Aciertos: <span id="correct">0</span></div>
      <div class="chip">Racha: <span id="streak">0</span></div>
      <div class="small" style="margin-left:auto">Pregunta <span id="qcount">0</span> — Generación instantánea</div>
    </div>

    <footer>
      <div class="small">Sugerencia: usa los controles para ajustar el rango. Para DIVISION, el divisor será generado y el dividendo será divisor×cociente entero.</div>
      <div class="small">Hecho para práctica infinita • IanLangs-style</div>
    </footer>
  </main>

<script>
/*
  Juego de multiplicación y división (único archivo).
  - Genera preguntas aleatorias infinitas.
  - Las divisiones siempre tienen resultado entero: (dividendo = divisor * cociente).
  - Controles: operación (mult/div/both), rango mínimo/máximo, reiniciar estadísticas.
  - Teclas: Enter = verificar, Escape = limpiar.
  - Feedback inmediato, muestra respuesta correcta si fallas.
*/

/* --- Utilidades --- */
const randInt = (a,b) => Math.floor(Math.random()*(b - a + 1)) + a;

const $ = id => document.getElementById(id);

/* --- Estado del juego --- */
let state = {
  operation: 'both',
  min: 2,
  max: 12,
  mode: 'both',
  current: null,  // {a,b,op,answer,display}
  stats: {score:0, attempts:0, correct:0, streak:0, qcount:0}
};

/* --- Elementos UI --- */
const mathDisplay = $('mathDisplay');
const answerInput = $('answerInput');
const checkBtn = $('checkBtn');
const skipBtn = $('skipBtn');
const feedback = $('feedback');
const scoreEl = $('score');
const attemptsEl = $('attempts');
const correctEl = $('correct');
const streakEl = $('streak');
const qcountEl = $('qcount');

const operationSel = $('operation');
const minVal = $('minVal');
const maxVal = $('maxVal');
const resetBtn = $('resetBtn');
const modeSel = $('mode');

/* --- Sincronización de controles --- */
operationSel.addEventListener('change', ()=>{ state.operation = operationSel.value; nextQuestion(); });
minVal.addEventListener('change', ()=>{ state.min = Math.max(0, parseInt(minVal.value||0)); sanitizeRange(); nextQuestion(); });
maxVal.addEventListener('change', ()=>{ state.max = Math.max(1, parseInt(maxVal.value||1)); sanitizeRange(); nextQuestion(); });
modeSel.addEventListener('change', ()=>{ state.mode = modeSel.value; nextQuestion(); });

function sanitizeRange(){
  if(state.max < state.min) { let tmp = state.max; state.max = state.min; state.min = tmp; minVal.value = state.min; maxVal.value = state.max; }
  // evitar rangos absurdos
  if(state.max - state.min > 1000){ state.max = state.min + 1000; maxVal.value = state.max; }
}

/* --- Generador de preguntas --- */
function generateMultiplication(min,max){
  // según modo podemos favorecer resultados pequeños
  if(state.mode === 'productSmall'){
    // producto pequeño: elegimos factores que den producto <= max*max pero con preferencia a menores
    const a = randInt(min, Math.min(max, 10));
    const b = randInt(min, Math.min(max, 10));
    return {op:'×', a, b, answer: a*b, display: `${a} × ${b}`};
  } else {
    const a = randInt(min, max);
    const b = randInt(min, max);
    return {op:'×', a, b, answer: a*b, display: `${a} × ${b}`};
  }
}

function generateDivision(min,max){
  // Para asegurar que la división da entero: elegimos divisor y cociente, luego multiplicamos.
  // Elegimos divisor d en [min..max] y cociente q en [min..max], dividendo = d*q.
  // Evitar divisor 0 - min al menos 1 (los controles iniciales usan 2).
  const d = randInt(Math.max(1,min), Math.max(1,max));
  const q = randInt(Math.max(1,min), Math.max(1,max));
  const dividend = d * q;
  // Mostrar "dividend ÷ divisor"
  return {op:'÷', a:dividend, b:d, answer: q, display: `${dividend} ÷ ${d}`};
}

function pickOperation(){
  if(state.operation === 'both'){
    return Math.random() < 0.5 ? 'mult' : 'div';
  }
  return state.operation; // 'mult' or 'div'
}

function nextQuestion(){
  sanitizeRange();
  state.stats.qcount++;
  qcountEl.textContent = state.stats.qcount;
  feedback.textContent = '';
  answerInput.value = '';
  answerInput.focus();

  const op = pickOperation();
  const min = Math.max(0, state.min);
  const max = Math.max(min+1, state.max); // asegurar max >= min+1
  let q;
  if(op === 'mult'){
    q = generateMultiplication(min, max);
  } else {
    q = generateDivision(min, max);
  }
  state.current = q;
  mathDisplay.textContent = q.display;
  // accessibility hint:
  $('hint').textContent = (q.op === '÷') ? 'División con resultado entero (generada por divisor×cociente).' : 'Multiplicación.';
}

/* --- Comprobación de respuestas --- */
function verifyAnswer(){
  if(!state.current) return;
  const raw = answerInput.value.trim();
  if(raw === '') {
    showFeedback('Escribe un número antes de verificar.', 'bad');
    return;
  }
  // Aceptar signos y espacios. Solo enteros.
  // Convertir a entero seguro:
  const parsed = parseInt(raw, 10);
  if(Number.isNaN(parsed)){
    showFeedback('Respuesta inválida. Escribe un número entero.', 'bad');
    return;
  }

  state.stats.attempts++;
  attemptsEl.textContent = state.stats.attempts;

  if(parsed === state.current.answer){
    // correcto
    state.stats.correct++;
    state.stats.score += 10 + Math.min(50, Math.abs(state.current.answer)); // puntaje simple
    state.stats.streak++;
    showFeedback('¡Correcto! +'+(10+Math.min(50, Math.abs(state.current.answer)))+' pts', 'good');
    updateStats();
    // generar la siguiente pregunta (infinito)
    setTimeout(nextQuestion, 600);
  } else {
    // incorrecto
    state.stats.streak = 0;
    showFeedback(`Incorrecto. La respuesta correcta es ${state.current.answer}`, 'bad');
    updateStats();
    // no penalizamos demasiado pero restamos algo
    state.stats.score = Math.max(0, state.stats.score - 5);
    // dejar la respuesta mostrada y generar nueva pregunta breve después
    setTimeout(nextQuestion, 1200);
  }
}

function showFeedback(msg, type){
  feedback.textContent = msg;
  feedback.className = 'feedback ' + (type === 'good' ? 'good' : 'bad');
}

function updateStats(){
  scoreEl.textContent = state.stats.score;
  correctEl.textContent = state.stats.correct;
  streakEl.textContent = state.stats.streak;
}

/* --- Eventos UI --- */
checkBtn.addEventListener('click', verifyAnswer);
skipBtn.addEventListener('click', ()=>{ showFeedback('Saltada → se mostrará la siguiente.', 'bad'); setTimeout(nextQuestion, 400); });

answerInput.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') { e.preventDefault(); verifyAnswer(); }
  if(e.key === 'Escape'){ answerInput.value = ''; feedback.textContent = ''; }
});

resetBtn.addEventListener('click', ()=>{
  state.stats = {score:0, attempts:0, correct:0, streak:0, qcount:0};
  updateStats();
  attemptsEl.textContent = 0;
  qcountEl.textContent = 0;
  feedback.textContent = '';
  nextQuestion();
});

/* Inicializar valores desde controles y comenzar */
function initFromControls(){
  state.operation = operationSel.value;
  state.min = parseInt(minVal.value || 2, 10);
  state.max = parseInt(maxVal.value || 12, 10);
  state.mode = modeSel.value;
  sanitizeRange();
  minVal.value = state.min;
  maxVal.value = state.max;
}
initFromControls();
nextQuestion();

/* Pequeña mejora: evitar pegar texto no numérico en el input */
answerInput.addEventListener('input', ()=>{
  // eliminar cualquier caracter que no sea - o dígito
  const clean = answerInput.value.replace(/[^\d-]/g, '');
  if(clean !== answerInput.value) answerInput.value = clean;
});
</script>
</body>
</html>
